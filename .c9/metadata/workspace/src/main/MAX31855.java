{"filter":false,"title":"MAX31855.java","tooltip":"/src/main/MAX31855.java","undoManager":{"mark":97,"position":97,"stack":[[{"start":{"row":0,"column":0},"end":{"row":95,"column":1},"action":"insert","lines":["package com.traviswyatt.pi.max31855;","","import java.util.Arrays;","","import com.pi4j.wiringpi.Spi;","","public class MAX31855 {","\t","\tpublic static final int THERMOCOUPLE_SIGN_BIT = 0x80000000; // D31","\tpublic static final int INTERNAL_SIGN_BIT     = 0x8000;     // D15","","\tpublic static final int FAULT_BIT = 0x10000; // D16","","\tpublic static final byte FAULT_OPEN_CIRCUIT_BIT = 0x01; // D0","\tpublic static final byte FAULT_SHORT_TO_GND_BIT = 0x02; // D1","\tpublic static final byte FAULT_SHORT_TO_VCC_BIT = 0x04; // D2","","\t/**","\t * 11 of the least most significant bits (big endian) set to 1.","\t */","\tpublic static final int LSB_11 = 0x07FF;","","\t/**","\t * 13 of the least most significant bits (big endian) set to 1.","\t */","\tpublic static final int LSB_13 = 0x1FFF;","","\tprivate final byte[] BUFFER = new byte[4];","\t","\tprivate final int channel;","","\tpublic MAX31855(int channel) {","\t\tthis.channel = channel;","\t}","","\t/**","\t * Read raw temperature data.","\t * ","\t * @param raw Array of raw temperatures whereas index 0 = internal, 1 = themocouple","\t * @return Returns any faults or 0 if there were no faults","\t */","\tpublic int readRaw(int[] raw) {","\t\tif (raw.length != 2)","\t\t\tthrow new IllegalArgumentException(\"Temperature array must have a length of 2\");","\t\t","\t\t// http://stackoverflow.com/a/9128762/196486","\t\tArrays.fill(BUFFER, (byte) 0); // clear buffer","\t\t","\t\tSpi.wiringPiSPIDataRW(channel, BUFFER, 4);","\t\t","\t\tint data = ((BUFFER[0] & 0xFF) << 24) |","\t\t\t\t   ((BUFFER[1] & 0xFF) << 16) |","\t\t\t\t   ((BUFFER[2] & 0xFF) <<  8) |","\t\t\t\t   (BUFFER[3] & 0xFF);","","\t\tint internal = (int) ((data >> 4) & LSB_11);","\t\tif ((data & INTERNAL_SIGN_BIT) == INTERNAL_SIGN_BIT) {","\t\t\tinternal = -(~internal & LSB_11);","\t\t}","","\t\tint thermocouple = (int) ((data >> 18) & LSB_13);","\t\tif ((data & THERMOCOUPLE_SIGN_BIT) == THERMOCOUPLE_SIGN_BIT) {","\t\t\tthermocouple = -(~thermocouple & LSB_13);","\t\t}","","\t\traw[0] = internal;","\t\traw[1] = thermocouple;","\t\t","\t\tif ((data & FAULT_BIT) == FAULT_BIT) {","\t\t\treturn data & 0x07;","\t\t} else {","\t\t\treturn 0; // no faults","\t\t}","\t}","\t","\t/**","\t * Converts raw internal temperature to actual internal temperature.","\t * ","\t * @param raw Raw internal temperature","\t * @return Actual internal temperature (C)","\t */","\tpublic float getInternalTemperature(int raw) {","\t\treturn raw * 0.0625f;","\t}","\t","\t/**","\t * Converts raw thermocouple temperature to actual thermocouple temperature.","\t * ","\t * @param raw Raw thermocouple temperature","\t * @return Actual thermocouple temperature (C)","\t */","\tpublic float getThermocoupleTemperature(int raw) {","\t\treturn raw * 0.25f;","\t}","\t","}"],"id":1,"ignore":true}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"insert","lines":["p"],"id":6}],[{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"insert","lines":["a"],"id":7}],[{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["c"],"id":8}],[{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["k"],"id":9}],[{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"insert","lines":["a"],"id":10}],[{"start":{"row":0,"column":5},"end":{"row":0,"column":6},"action":"insert","lines":["g"],"id":11}],[{"start":{"row":0,"column":6},"end":{"row":0,"column":7},"action":"insert","lines":["e"],"id":12}],[{"start":{"row":0,"column":7},"end":{"row":0,"column":8},"action":"insert","lines":[" "],"id":13}],[{"start":{"row":0,"column":8},"end":{"row":0,"column":9},"action":"insert","lines":["m"],"id":14}],[{"start":{"row":0,"column":9},"end":{"row":0,"column":10},"action":"insert","lines":["a"],"id":15}],[{"start":{"row":0,"column":10},"end":{"row":0,"column":11},"action":"insert","lines":["i"],"id":16}],[{"start":{"row":0,"column":11},"end":{"row":0,"column":12},"action":"insert","lines":["n"],"id":17}],[{"start":{"row":0,"column":12},"end":{"row":0,"column":13},"action":"insert","lines":[";"],"id":18}],[{"start":{"row":0,"column":13},"end":{"row":0,"column":14},"action":"insert","lines":["/"],"id":19}],[{"start":{"row":0,"column":14},"end":{"row":0,"column":15},"action":"insert","lines":["/"],"id":20}],[{"start":{"row":46,"column":48},"end":{"row":47,"column":0},"action":"insert","lines":["",""],"id":21},{"start":{"row":47,"column":0},"end":{"row":47,"column":2},"action":"insert","lines":["\t\t"]}],[{"start":{"row":47,"column":2},"end":{"row":47,"column":45},"action":"insert","lines":["int fd = Spi.wiringPiSPISetup(0, 10000000);"],"id":22}],[{"start":{"row":49,"column":44},"end":{"row":50,"column":0},"action":"insert","lines":["",""],"id":23},{"start":{"row":50,"column":0},"end":{"row":50,"column":2},"action":"insert","lines":["\t\t"]}],[{"start":{"row":50,"column":2},"end":{"row":50,"column":3},"action":"insert","lines":["S"],"id":24}],[{"start":{"row":50,"column":2},"end":{"row":50,"column":3},"action":"remove","lines":["S"],"id":25}],[{"start":{"row":50,"column":2},"end":{"row":50,"column":3},"action":"insert","lines":["f"],"id":26}],[{"start":{"row":50,"column":3},"end":{"row":50,"column":4},"action":"insert","lines":["o"],"id":27}],[{"start":{"row":50,"column":4},"end":{"row":50,"column":5},"action":"insert","lines":["r"],"id":28}],[{"start":{"row":50,"column":5},"end":{"row":50,"column":7},"action":"insert","lines":["()"],"id":29}],[{"start":{"row":50,"column":6},"end":{"row":50,"column":7},"action":"insert","lines":["b"],"id":30}],[{"start":{"row":50,"column":7},"end":{"row":50,"column":8},"action":"insert","lines":["y"],"id":31}],[{"start":{"row":50,"column":8},"end":{"row":50,"column":9},"action":"insert","lines":["t"],"id":32}],[{"start":{"row":50,"column":9},"end":{"row":50,"column":10},"action":"insert","lines":["e"],"id":33}],[{"start":{"row":50,"column":10},"end":{"row":50,"column":11},"action":"insert","lines":[" "],"id":34}],[{"start":{"row":50,"column":11},"end":{"row":50,"column":12},"action":"insert","lines":["b"],"id":35}],[{"start":{"row":50,"column":12},"end":{"row":50,"column":13},"action":"insert","lines":[" "],"id":36}],[{"start":{"row":50,"column":13},"end":{"row":50,"column":14},"action":"insert","lines":[":"],"id":37}],[{"start":{"row":50,"column":14},"end":{"row":50,"column":15},"action":"insert","lines":[" "],"id":38}],[{"start":{"row":50,"column":15},"end":{"row":50,"column":16},"action":"insert","lines":["r"],"id":39}],[{"start":{"row":50,"column":16},"end":{"row":50,"column":17},"action":"insert","lines":["a"],"id":40}],[{"start":{"row":50,"column":17},"end":{"row":50,"column":18},"action":"insert","lines":["w"],"id":41}],[{"start":{"row":50,"column":15},"end":{"row":50,"column":18},"action":"remove","lines":["raw"],"id":42},{"start":{"row":50,"column":15},"end":{"row":50,"column":33},"action":"insert","lines":["rawTemperatureData"]}],[{"start":{"row":50,"column":34},"end":{"row":50,"column":35},"action":"insert","lines":["{"],"id":43}],[{"start":{"row":50,"column":35},"end":{"row":52,"column":3},"action":"insert","lines":["","\t\t\t","\t\t}"],"id":44}],[{"start":{"row":51,"column":3},"end":{"row":51,"column":4},"action":"insert","lines":["S"],"id":45}],[{"start":{"row":51,"column":4},"end":{"row":51,"column":5},"action":"insert","lines":["y"],"id":46}],[{"start":{"row":51,"column":5},"end":{"row":51,"column":6},"action":"insert","lines":["s"],"id":47}],[{"start":{"row":51,"column":6},"end":{"row":51,"column":7},"action":"insert","lines":["t"],"id":48}],[{"start":{"row":51,"column":7},"end":{"row":51,"column":8},"action":"insert","lines":["e"],"id":49}],[{"start":{"row":51,"column":8},"end":{"row":51,"column":9},"action":"insert","lines":["m"],"id":50}],[{"start":{"row":51,"column":9},"end":{"row":51,"column":10},"action":"insert","lines":["."],"id":51}],[{"start":{"row":51,"column":10},"end":{"row":51,"column":11},"action":"insert","lines":["o"],"id":52}],[{"start":{"row":51,"column":11},"end":{"row":51,"column":12},"action":"insert","lines":["u"],"id":53}],[{"start":{"row":51,"column":12},"end":{"row":51,"column":13},"action":"insert","lines":["t"],"id":54}],[{"start":{"row":51,"column":13},"end":{"row":51,"column":14},"action":"insert","lines":["."],"id":55}],[{"start":{"row":51,"column":14},"end":{"row":51,"column":15},"action":"insert","lines":["p"],"id":56}],[{"start":{"row":51,"column":15},"end":{"row":51,"column":16},"action":"insert","lines":["r"],"id":57}],[{"start":{"row":51,"column":16},"end":{"row":51,"column":17},"action":"insert","lines":["i"],"id":58}],[{"start":{"row":51,"column":17},"end":{"row":51,"column":18},"action":"insert","lines":["n"],"id":59}],[{"start":{"row":51,"column":18},"end":{"row":51,"column":19},"action":"insert","lines":["t"],"id":60}],[{"start":{"row":51,"column":19},"end":{"row":51,"column":20},"action":"insert","lines":["l"],"id":61}],[{"start":{"row":51,"column":20},"end":{"row":51,"column":21},"action":"insert","lines":["n"],"id":62}],[{"start":{"row":51,"column":21},"end":{"row":51,"column":23},"action":"insert","lines":["()"],"id":63}],[{"start":{"row":51,"column":22},"end":{"row":51,"column":24},"action":"insert","lines":["\"\""],"id":64}],[{"start":{"row":51,"column":23},"end":{"row":51,"column":24},"action":"insert","lines":["b"],"id":65}],[{"start":{"row":51,"column":23},"end":{"row":51,"column":24},"action":"remove","lines":["b"],"id":66}],[{"start":{"row":51,"column":22},"end":{"row":51,"column":24},"action":"remove","lines":["\"\""],"id":67}],[{"start":{"row":51,"column":22},"end":{"row":51,"column":23},"action":"insert","lines":["b"],"id":68}],[{"start":{"row":51,"column":23},"end":{"row":51,"column":24},"action":"insert","lines":[";"],"id":69}],[{"start":{"row":51,"column":23},"end":{"row":51,"column":24},"action":"remove","lines":[";"],"id":70}],[{"start":{"row":51,"column":24},"end":{"row":51,"column":25},"action":"insert","lines":[";"],"id":71}],[{"start":{"row":50,"column":16},"end":{"row":50,"column":33},"action":"remove","lines":["awTemperatureData"],"id":72}],[{"start":{"row":50,"column":15},"end":{"row":50,"column":16},"action":"remove","lines":["r"],"id":73}],[{"start":{"row":50,"column":15},"end":{"row":50,"column":16},"action":"insert","lines":["b"],"id":74}],[{"start":{"row":50,"column":16},"end":{"row":50,"column":17},"action":"insert","lines":["u"],"id":75}],[{"start":{"row":50,"column":17},"end":{"row":50,"column":18},"action":"insert","lines":["f"],"id":76}],[{"start":{"row":50,"column":18},"end":{"row":50,"column":19},"action":"insert","lines":["f"],"id":77}],[{"start":{"row":50,"column":19},"end":{"row":50,"column":20},"action":"insert","lines":["e"],"id":78}],[{"start":{"row":50,"column":20},"end":{"row":50,"column":21},"action":"insert","lines":["r"],"id":79}],[{"start":{"row":50,"column":21},"end":{"row":50,"column":22},"action":"insert","lines":["\t"],"id":80}],[{"start":{"row":50,"column":22},"end":{"row":50,"column":23},"action":"insert","lines":["e"],"id":81}],[{"start":{"row":50,"column":22},"end":{"row":50,"column":23},"action":"remove","lines":["e"],"id":82}],[{"start":{"row":50,"column":21},"end":{"row":50,"column":22},"action":"remove","lines":["\t"],"id":83}],[{"start":{"row":48,"column":2},"end":{"row":52,"column":3},"action":"remove","lines":["","\t\tSpi.wiringPiSPIDataRW(channel, BUFFER, 4);","\t\tfor(byte b : buffer){","\t\t\tSystem.out.println(b);","\t\t}"],"id":84,"ignore":true}],[{"start":{"row":48,"column":1},"end":{"row":48,"column":2},"action":"remove","lines":["\t"],"id":85,"ignore":true}],[{"start":{"row":48,"column":0},"end":{"row":48,"column":1},"action":"remove","lines":["\t"],"id":86,"ignore":true}],[{"start":{"row":47,"column":45},"end":{"row":48,"column":0},"action":"remove","lines":["",""],"id":87,"ignore":true}],[{"start":{"row":47,"column":2},"end":{"row":47,"column":45},"action":"remove","lines":["int fd = Spi.wiringPiSPISetup(0, 10000000);"],"id":88,"ignore":true}],[{"start":{"row":47,"column":1},"end":{"row":47,"column":2},"action":"remove","lines":["\t"],"id":89,"ignore":true}],[{"start":{"row":46,"column":48},"end":{"row":47,"column":1},"action":"remove","lines":["","\t"],"id":90,"ignore":true}],[{"start":{"row":46,"column":48},"end":{"row":47,"column":2},"action":"insert","lines":["","\t\t"],"id":91,"ignore":true}],[{"start":{"row":47,"column":2},"end":{"row":48,"column":1},"action":"insert","lines":["int fd = Spi.wiringPiSPISetup(0, 10000000);","\t"],"id":92,"ignore":true}],[{"start":{"row":48,"column":1},"end":{"row":49,"column":0},"action":"insert","lines":["\t",""],"id":93,"ignore":true}],[{"start":{"row":49,"column":0},"end":{"row":52,"column":3},"action":"insert","lines":["\t\tSpi.wiringPiSPIDataRW(channel, BUFFER, 4);","\t\tfor(byte b : buffer\t){","\t\t\tSystem.out.println(b);","\t\t}"],"id":94,"ignore":true}],[{"start":{"row":50,"column":20},"end":{"row":50,"column":22},"action":"remove","lines":["r\t"],"id":95,"ignore":true}],[{"start":{"row":50,"column":19},"end":{"row":50,"column":20},"action":"remove","lines":["e"],"id":96,"ignore":true}],[{"start":{"row":47,"column":45},"end":{"row":52,"column":3},"action":"remove","lines":["","\t\t","\t\tSpi.wiringPiSPIDataRW(channel, BUFFER, 4);","\t\tfor(byte b : buff){","\t\t\tSystem.out.println(b);","\t\t}"],"id":97,"ignore":true}],[{"start":{"row":47,"column":45},"end":{"row":52,"column":3},"action":"insert","lines":["","\t\t","\t\tSpi.wiringPiSPIDataRW(channel, BUFFER, 4);","\t\tfor(byte b : buff){","\t\t\tSystem.out.println(b);","\t\t}"],"id":98,"ignore":true}],[{"start":{"row":49,"column":44},"end":{"row":52,"column":3},"action":"remove","lines":["","\t\tfor(byte b : buff){","\t\t\tSystem.out.println(b);","\t\t}"],"id":99,"ignore":true}],[{"start":{"row":47,"column":1},"end":{"row":47,"column":45},"action":"remove","lines":["\tint fd = Spi.wiringPiSPISetup(0, 10000000);"],"id":100,"ignore":true}],[{"start":{"row":47,"column":0},"end":{"row":47,"column":1},"action":"remove","lines":["\t"],"id":101,"ignore":true}],[{"start":{"row":46,"column":48},"end":{"row":47,"column":0},"action":"remove","lines":["",""],"id":102,"ignore":true}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":38,"column":27},"end":{"row":38,"column":27},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":20,"state":"start","mode":"ace/mode/java"}},"timestamp":1470319580711,"hash":"3e4d19842058b81acdb0f880919ecfc8016613df"}